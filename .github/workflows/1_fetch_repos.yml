name: Fetch Rust Repositories
on:
  workflow_dispatch:

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y jq curl

      - name: Fetch top Rust repositories
        run: |
          rm -f repos.txt
          for page in {1..10}; do
            curl -s "https://api.github.com/search/repositories?q=language:Rust&sort=stars&order=desc&page=$page" \
            | jq -r '.items[].full_name' >> repos.txt
            sleep 2
          done
          echo "Total repos fetched: $(wc -l < repos.txt)"

      - name: Upload repos.txt artifact
        uses: actions/upload-artifact@v4
        with:
          name: rust-repos
          path: repos.txt
